<html>
	<head>

		<script type="text/javascript" src="../bin/vis.js"></script>

		<style>

			canvas {
				display: block;
				margin: auto;
			}

			body {
				font-family: "Helvetica Neue", sans-serif;
			}

			h1 {
				width: 600px;
				margin: auto;
			}

		</style>

	</head>
	<body>

		<h1>A Square of Simplex Perlin Noise</h2>

		<canvas id="testCanvas"></canvas>

	</body>

	<script>
		// sketch code goes here
		
		var sketch = new VIS("#testCanvas", { global: true });

		var w = 600;
		var h = 600;
		size(w, h);

		var rawPixelImg = new RawPixels();

		var px = rawPixelImg.getPx();

		var rowLen = 4 * w;

		var x, y, rand;
		for (var i = 0, l = px.length; i < l; i += 4) {
			x = ((i / 4) % 600) + 1;
			y = Math.ceil((i / 4) / 600) + 1;
			rand = Math.round(noise(x, y) * 255);
//			rand = Math.round(Math.random() * 255);
			px[i] = rand;
			px[i + 1] = rand;
			px[i + 2] = rand;
			// alpha channel
			px[i + 3] = 255;
		}

		// smooth
		for (var i = 0, l = px.length; i < l; i += 4) {
			var l, t, r, b, avgVal;
			l = px[i - 4] || 0;
			t = px[i - rowLen] || 0;
			r = px[i + 4] || 0;
			b = px[i + rowLen] || 0;

			avgVal = avg(l, t, r, b);
			px[i] = avgVal;
			px[i + 1] = avgVal;
			px[i + 2] = avgVal;
		}

		function avg() {
			var avg = 0;
			for (var i = 0, l = arguments.length; i < l; ++i) {
				avg += arguments[i] / l;
			}
			return avg;
		}

		rawPixelImg.draw();
//		rawPixelImg.setPx(px);


	</script>
</html>
<html>
	<head>

		<script type="text/javascript" src="../vis.js"></script>

		<style>

			body {
				background-color: #000;	
			}

			canvas {
				display: block;
				margin: auto;
			}

		</style>

	</head>
	<body>

		<canvas id="testCanvas"></canvas>

	</body>

	<script>
		// sketch code goes here
		// work on a fire algorithm, as explained HERE: http://www.gamedev.net/page/resources/_/technical/graphics-programming-and-theory/simple-fire-effect-r222
		// AND HERE: https://www.google.com/search?q=fire+algorithm&oq=fire+algorithm&aqs=chrome..69i57j0l3.1783j0&sourceid=chrome&ie=UTF-8

		VIS.install();
		setCanvas(document.getElementById("testCanvas"));

		size(600, 600);

		var canvasImage = new ImageData();
		var px = canvasImage.getPx();
 
		for (var i = 3, l = px.length; i < l; i += 4) {
			px[i] = 255;
		}

		canvasImage.draw();

		var rowLen = width * 4;

		var paused = false;
		function stop() {
			paused = true;
		}
		function play() {
			paused = false;
		}

		function avg() {
			var avg = 0;
			for (var i = 0, l = arguments.length; i < l; ++i) {
				avg += arguments[i] / l;
			}
			return avg;
		}

		function palette(x) {
			// TODO: color palette that takes 1 - 255 and returns a good color
		}

		function update() {
			if (!paused) {
				px = canvasImage.getPx();
				var rand;
				for (var i = px.length - 1, end = i - rowLen; i > end; i -= 4) {
					rand = random(0, 255);
					px[i - 1] = random(0, 50);
					px[i - 2] = rand;
					px[i - 3] = 255;
				}

				var l, r, b, o;
				for (; i >= 0; i -= 4) {
					px[i - 1] = smooth2(px, i - 1);
					px[i - 2] = smooth2(px, i - 2);
					px[i - 3] = smooth2(px, i - 3);
				}

			}
		}

		function smooth1(arr, i) {
			var l, r, b;
			l = arr[i + rowLen - 4] || 0;
			b = arr[i + rowLen];
			r = arr[i + rowLen + 4] || 0;
			return Math.floor(avg(l, b, r));
		}

		function smooth2(arr, i) {
			var l, r, b, o;
			o = arr[i];
			l = arr[i + rowLen - 4] || 0;
			b = arr[i + rowLen];
			r = arr[i + rowLen + 4] || 0;
			return Math.floor(avg(o, l, b, r));
		}

		function draw() {
			if (!paused) {
				canvasImage.draw();
			}
		}

	</script>
</html>